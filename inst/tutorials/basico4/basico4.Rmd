---
title: "La gramática de los gráficos"
description: "Aprender las reglas de la gramática de los gráficos usando ggplot2"
output: 
  learnr::tutorial:
    progressive: true
    allow_skip: true
runtime: shiny_prerendered
---

<style>
.tutorialTitle {
text-align: left}
body {
text-align: justify}
</style>

```{r setup, include=FALSE}
library(learnr)
library(tidyverse)
library(gapminder)
knitr::opts_chunk$set(echo = FALSE)
```

## Introducción

La habilidad de crear gráficos a partir de los datos que recolectamos potencia nuestra capacidad de análisis. Los gráficos nos pueden ayudar a percibir de manera rápida patrones de comportamiento en nuestra data y, al mismo tiempo, resumir de manera visual aquello que queremos mostrar a nuestra audiencia.

Este tutorial tiene como objetivo explicar el uso de la gramática de los gráficos, un marco conceptual cuya aplicación permite realizar visualizaciones de datos de manera sencilla y coherente. No vamos a buscar explicar todos los elementos teóricos que existen detrás del marco conceptual mencionado. En cambio, preferimos explicar sólo los elementos clave, usando ejemplos claros para que, al finalizar el tutorial, cualquiera pueda intentar crear sus propios gráficos.

No somos las primeras personas en tratar de explicar este tema. De hecho, este tutorial será una adaptación del gran trabajo realizado por [Chester Ismay](https://chester.rbind.io/) y [Albert Y. Kim](https://rudeboybert.rbind.io/) en su libro [*Statistical Inference via Data Science: A ModernDive into R and the Tidyverse*](https://moderndive.com/2-viz.html).

## Tema 1: La gramática

El paquete `ggplot2`, elaborado por [Hadley Wickham](http://hadley.nz/) es la implementanción en R de la gramática de los gráficos, teoría desarrollada por [Leland Wilkinson](https://www.cs.uic.edu/~wilkinson/). Puedes cargar `ggplot2` individualmente o junto con los paquetes del `tidyverse`.

```{r library, eval=FALSE, echo=TRUE}
# Sólo ggplot2
library(ggplot2)

# Todo el tidyverse
library(tidyverse)
```

Del mismo modo que para construir una oración en nuestro idioma, hacemos uso de combinaciones de palabras (que pueden ser sustantivos, verbos, adjetivos, etc)  siguiendo un conjunto de reglas conocido como *gramática*, la *gramática de los gráficos* nos brinda las reglas para contruir gráficos estadísticos. 

### Componentes de la gramática

En pocas palabras, la gramática de los gráficos nos quiere decir que:

> Un gráfico estadístico es el **mapeo** de variables en nuestra **data** hacia  atributos **estéticos** de figuras **geométricas**. 

Podemos construir un gráfico a partir de tres componentes esenciales:

1. `data`: el set de datos que contiene las variables de interés
2. `geom`: las figuras geométricas en cuestión. Nos referimos al tipo de objeto que podemos observar en un gráfico. Por ejemplo: puntos, líneas o barras. 
3. `aes`: los atributos estéticos de la figura geométrica. Por ejemplo, su posición en los ejes x/y, color, forma y tamaño. Los atributos estéticos son *mapeados* a las variables contenidas en nuestro set de datos. 

### Un breve ejemplo

Para mostrar lo simple que puede resultar graficar usando los componentes mencionados, usaremos datos del paquete `gapminder`. Para este primer ejemplo utilizaremos sólo los datos de expectativa de vida en Perú a lo largo de los años. Para ello crearemos `df_ejemplo`.

```{r df_ejemplo, echo=TRUE}
library(gapminder)
library(dplyr)

df_ejemplo <- gapminder %>% 
  select(country, year, lifeExp) %>% 
  filter(country == "Peru")
```

Ahora que tenemos `df_ejemplo`, sólo necesitamos usar dos líneas de código para ver la evolución de la expectativa de vida de los peruanos. Recuerda que para ello hemos cargado previamente `ggplot2`.

```{r df_ejemplo_setup}
df_ejemplo <- gapminder %>% 
  select(country, year, lifeExp) %>% 
  filter(country == "Peru")
```

```{r plot_ex1, exercise=TRUE, exercise.setup="df_ejemplo_setup"}
# Ejecuta este código para realizar tu primer gráfico
ggplot(data = df_ejemplo, mapping = aes(x = year, y = lifeExp)) +
  geom_line()
```

¿Cómo funciona la gramática? Anteriormente te habíamos mencionado que `ggplot` requiere tres componentes básicos para crear gráficos: los datos, el mapeo de variables y las figuras geométricas que representarán nuestros datos. En el código de arriba, le indicamos a la función `ggplot()` que nuestra *data* será `df_ejemplo`, con *mapping* le pedimos que mapee la variable `year` al eje *X* y la variable `lifeExp` al eje *Y*. Además de hacer esto, es necesario indicarle qué figura geométrica debe usar `ggplot` para representar nuestros datos. Esta instrucción se la indicamos con `geom_line()`, pidiendole que lo haga con una línea.

### ggplot conciso

Debido a que el primer argumento siempre será nuestra data, y en el mapeo de variables los dos primeros atributos siempre corresponden al eje *X* y al eje *Y*, podemos reescribir el código del gráfico anterior de forma más concisa.

```{r plot_ex2, exercise = TRUE, exercise.setup="df_ejemplo_setup"}
ggplot(df_ejemplo, aes(year, lifeExp)) + 
  geom_line()
```

### Puedo usar pipes

No sólo eso. Recuerda que podemos usar el operador *pipe* para realizar una secuencia de pasos en nuestro análisis siempre y cuando el primer argumento de nuestra función requiera datos, como ocurre con `ggplot`. ¡Esto quiere decir que no era obligatorio crear primero `df_ejemplo`!

```{r plot_ex3, exercise = TRUE, exercise.setup="df_ejemplo_setup"}
gapminder %>% 
  select(country, year, lifeExp) %>% 
  filter(country == "Peru") %>% 
  ggplot(aes(year, lifeExp)) + 
  geom_line()
```

¡Pero no te confíes! Date cuenta que para agregar elementos después de la función `ggplot()`, hacemos uso del operador de suma y no de *pipes*.

## Los cinco gráficos nombrados

### Gráfico de líneas

### Gráfico de barras

### Diagrama de dispersión

### Histogramas

### Diagramas de caja o boxplot



